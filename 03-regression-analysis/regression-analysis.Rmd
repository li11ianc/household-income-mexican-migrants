---
title: "Characteristics of Recent Mexican Immigrants to the United States that Influence Household Income"
subtitle: "Regression Analysis"
author: "Ben 10"
date: "November 20, 2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

```

```{r load-packages}
library(tidyverse)
library(broom)
library(leaps)
library(knitr)
library(dplyr)
```

```{r data}
data <- read_csv("/cloud/project/03-regression-analysis/data.csv")
data
```

## 1. Introduction

We are aiming to discover what characteristics of Mexican immmigrants to the United States, specifically California, influence their projected household income. We will be building a multiple linear regression model to predict household income considering the following variables: `sex`, `relhead`, `age`, `statebrn`, `marstat`, `edyrs`, `occtype`, `usdur1`, `usdurl`, `usdoc1`, `uscity`, `yrborn`.

Our response variable is household income: the total income for a single household, reported in $USD. 


## 2. Exploratory Data Analysis


```{r caldata}
caldata <- data %>%
  filter(usstatel == "California")
```

```{r mutate-income}
caldata <- caldata %>%
  mutate(hhincome = case_when(
    hhincome > exp(11) ~ hhincome/19.44,
    hhincome < exp(11) ~ hhincome
  ))
caldata
```

```{r cities}
caldata <- caldata %>%
  filter(uscity %in% c("Bakersfield, CA","Bakersfield, CA", "Fresno, CA", "Los Angeles-Long Beach, CA", "Merced, CA","Orange County, CA","Riverside-San Bernardino, CA", "Sacramento, CA", "San Diego, CA", "San Francisco, CA", "San Jose, CA","Santa Barbara-Santa Maria-Lompoc, CA","Santa Cruz-Watsonville, CA","Vallejo-Fairfield-Napa, CA","Ventura, CA"))
ggplot(data = caldata, aes(x = uscity))+ 
  geom_bar() +
  coord_flip()
```
These immigrants to California arrived to the following cities: Los Angeles-Long Beach, San Francisco, San Diego, Santa Cruz-Watsonville, Bakersfield, Fresno, Merced, Orange County, Riverside-San Bernardino, Sacramento, San Jose, Santa Barbara-Santa Maria-Lompoc, Vallejo-Fairfield-Napa, and Ventura. Given the comparatively small number of cases in which no city was reported, we deleted these instances. This leaves 15 unique locations in California. The majority of immigrants went to LA-Long Beach area. 

It turned out that all values from relhead in our cleaned data were "1" or head. So we will remove this variable, as well as state variables since we are only using California data. We will also remove place data since we are using uscity, and occ since we are using occtype.

```{r remove-relhead}
caldata <- subset(caldata, select = -c(relhead, usstatel, usstate1,usplace1, usplacel,occ) )
```

## 2. Multiple Linear Regression Model

In an effort to determine which characteristics of candidates influence their household income, we will be using a multiple linear regression model. Since our response variable is numerical with mulitple potential predictors, this is the best model at our disposal for us to use.

We will consider the potential interaction between principal occupation and number of years of school completed, since those are generally interconnected. We may also consider the interaction between documentation type and occupation type, although the effect may be insignificant.

We will select our model using AIC criteria, because since we're dealing with people, we want to build a model that accounts for volatile human nature and the ever-changing socioeconomic and political climate that could influence someone's household income. AIC is used when we would rather say a variable is a relevant predictor, when in reality it might not be and so in this case, we would rather err on the side of a false positive because we are dealing with a constantly fluctuating issue.

### 2.1 Full Model

```{r model}
model1 <- lm(hhincome ~ .,
data=caldata)
kable(tidy(model1),format="html"
,digits=3)
```

### 2.2 Backward selection

### 2.3 Interactions

### 2.4 F-test



 


## 3. Check Assumtpions






## 4. Interpretations

## 5. Additional Work
















#### Lilly

```{r}
ggplot(data = caldata, aes(x = log(hhincome))) +
  geom_histogram()+
  labs(title = "Distribution of Log(Household Income)", x= "log(Household Income)", y = "Count")
```

Originally, the distribution of log(Household Income)- our response variable- was bimodal and had a mean of 412,647 dollars. We determined that this is an absurdly high median income for a survey of largely undocumented immigrants in the US and believe that a significant chunk of the high incomes were actually recorded in pesos. We will filter out the incomes above 60,000 to remove what appears to be a second distribution of incomes in pesos. We will also remove incomes of zero from our dataset.

```{r filter-hhincome}
caldata <- caldata %>%
  mutate(hhincome = case_when(
    hhincome == .1 ~ 0,
    TRUE ~ hhincome
  )) #undoing mutation from proposal to return 0 income variables to 0
caldata <- caldata %>%
  filter(hhincome > 5, log(hhincome) < 8)
```

```{r}
ggplot(data = caldata, aes(x = hhincome)) +
  geom_histogram()
```

Your regression analysis results go here. At a minimum, the regression analysis should include the following: 

- Statement of the research question and modeling obejctive (prediction, inference, etc.)

- Description of the response variable

- Updated exploratory data analysis, incorporating any feedback from the proposal
- Explanation of the modeling process and why you chose those metohds, incorporating any feedback from the proposal
- Output of the final model
- Discussion of the assumptions for the final model
- Interpretations / interesting findings from the model coefficients
- Additional work of other models or analylsis not included in the final model.

*Use proper headings as needed.*