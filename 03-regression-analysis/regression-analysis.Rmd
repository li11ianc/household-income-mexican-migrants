---
title: "Characteristics of Recent Mexican Immigrants to the US"
subtitle: "Regression Analysis"
author: "Ben 10"
date: "November 14, 2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

```

```{r load-packages}
library(tidyverse)
library(broom)
library(leaps)
library(knitr)
library(dplyr)
```

```{r data}
data <- read_csv("/cloud/project/03-regression-analysis/data.csv")
data
```

```{r caldata}
caldata <- data %>%
  filter(usstatel == "California")
```

WHAT WE NEED TO DO:
-Statement of the research question and modeling obejctive (prediction, inference, etc.)
-Description of the response variable
-Updated exploratory data analysis, incorporating any feedback from the proposal
-Explanation of the modeling process and why you chose those metohds, incorporating any feedback from the proposal
-Output of the final model
-Discussion of the assumptions for the final model
-Interpretations / interesting findings from the model coefficients
-Additional work of other models or analylsis not included in the final model.


## 1. Multiple Linear Regression Model

### 1.1 Full Model

### 1.2 Backward selection

### 1.3 Interactions

### 1.4 F-test






## 2. Check Assumtpions

Before interpreting the model, it is essential to check the assumptions.

### 2.1 Linearity
```{r}
names(data)
```

#### 2.1.1 Predicted vs. Factors
```{r scatter_pairs}
pairs(log(hhincome) ~ yrborn + age +  usdur1 + usdurl, data = data,
      lower.panel = NULL)
```

From the data exploratory section, we have observed a linear pattern in graph of each predictor against log(price). Hence, the linearity assumption is met.

### 2.2 Constant Variance

#### 2.2.1 Residuals vs. Factors

```{r}
houses <- houses %>% 
  mutate(predicted = predict.lm(logprice_model), residuals = resid(logprice_model))
```

Below is the plots of residuals against each quantitative predictor:
```{r factor_residual_scatterplot}
pairs(residuals ~ floorsCat + sqftCent + bedroomsCent + bathroomsCent + waterfront, data = houses,
      lower.panel = NULL) 
```

Below is the graph of residuals against categorical predictor:
```{r floorCat_residual}
ggplot(data=houses,aes(x=floorsCat,y=residuals)) + 
  geom_boxplot() + 
  geom_hline(yintercept=0,color="red") +
  labs(x = "Number of Floors", 
       y="Residuals",
       title= "Boxplot of Residuals vs. Number of Floors")
```

From the pairs scatterplot, I cannot observe any clear patterns; and from the boxplot, the median of each category seems to be close to 0, expect for a slight positive deviation in the 1.5 Floor category, and all categories are relatively symmetrical. 

#### 2.2.2 Residual vs. Predicted
```{r residuel_predicted_scatterplot}
houses <- houses %>% 
  mutate(predicted = predict.lm(logprice_model), residuals = resid(logprice_model))
ggplot(data=houses,aes(x=predicted, y=residuals)) + 
  geom_point() + 
  geom_hline(yintercept=0,color="red") +
  labs(title="Residuals vs. Predicted Log(price)")
```

The residual vs. predicted values scatterplot shows a large concentration of data points in the 12 to 14 units range of the x-axis. However, there are alarming outliers around 17 units. There are no discernible patterns. 

Overall, the graphs confirm the constant variance assumption is satisfied.


### 2.3 Normality

#### 2.3.1 Histogram of Residuals
```{r histogram_residuals}
ggplot(data=houses, mapping=aes(x=residuals)) + 
  geom_histogram() +
  labs(title="Distribution of Residuals", x="Residual")
```

#### 2.3.2 Normal-QQ Plot of Residuals

```{r}
ggplot(data=houses,mapping=aes(sample=residuals)) +
  stat_qq() +
  stat_qq_line() +
  labs(title="Normal QQ Plot of Residuals")
```

From the histogram, the shape of distribution of residuals resembles a normal distribution. The Normal-QQ plot supports this finding as the sample line adheres closely to the theoretical line.So the normality assumption is met.


### 2.4 Independence
Since the houses independent owners, we can assume that each data entry is independent from the rest. However, there may be some dependence/interaction between houses in the same neighborhood. If we have access to the geographic location of the houses, we can possibly add that as a predictor in the model.




## 3. Interpretations

## 4. Additional Work
















#### Qintian
```{r}
caldata <- caldata %>%
  mutate(hhincome = case_when(
    hhincome > exp(11) ~ hhincome/19.44,
    hhincome < exp(11) ~ hhincome
  ))
caldata
```

#### Thea


#### Rachel
```{r cities}
caldata <- caldata %>%
  filter(uscity %in% c("Bakersfield, CA","Bakersfield, CA", "Fresno, CA", "Los Angeles-Long Beach, CA", "Merced, CA","Orange County, CA","Riverside-San Bernardino, CA", "Sacramento, CA", "San Diego, CA", "San Francisco, CA", "San Jose, CA","Santa Barbara-Santa Maria-Lompoc, CA","Santa Cruz-Watsonville, CA","Vallejo-Fairfield-Napa, CA","Ventura, CA"))
ggplot(data = caldata, aes(x = uscity))+ 
  geom_bar() +
  coord_flip()
```
These immigrants to California arrived to the following cities: Los Angeles-Long Beach, San Francisco, San Diego, Santa Cruz-Watsonville, Bakersfield, Fresno, Merced, Orange County, Riverside-San Bernardino, Sacramento, San Jose, Santa Barbara-Santa Maria-Lompoc, Vallejo-Fairfield-Napa, and Ventura. Given the comparatively small number of cases in which no city was reported, we deleted these instances. This leaves 15 unique locations in California. The majority of immigrants went to LA-Long Beach area. 

It turned out that all values from relhead in our cleaned data were "1" or head. So we will remove this variable, as well as state variables since we are only using California data. We will also remove place data since we are using uscity

```{r remove relhead}
caldata <- subset(caldata, select = -c(relhead, usstatel, usstate1,usplace1, usplacel) )

```


#### Lilly

```{r}
ggplot(data = caldata, aes(x = log(hhincome))) +
  geom_histogram()+
  labs(title = "Distribution of Log(Household Income)", x= "log(Household Income)", y = "Count")
```


```{r filter-na}
data <- data %>%
  mutate(hhincome = case_when(
    hhincome == .1 ~ 0,
    TRUE ~ hhincome
  )) #undoing mutation from proposal to return 0 income variables to 0
```

```{r}
caldata <- caldata %>%
  filter(hhincome < 60000)
```

```{r}
caldata %>%
  filter(hhincome < exp(11)) %>%
  ggplot(aes(x = log(hhincome))) +
  geom_histogram()
caldata <- caldata %>%
  mutate(hhincome = case_when(
    hhincome > exp(11) ~ hhincome/300,
    hhincome < exp(11) ~ hhincome
  ))
caldata <- caldata %>%
  filter(hhincome > 5)
ggplot(data = caldata, aes(x = log(hhincome))) +
  geom_histogram()


```

Your regression analysis results go here. At a minimum, the regression analysis should include the following: 

- Statement of the research question and modeling obejctive (prediction, inference, etc.)

We are aiming to discover what characteristics of Mexican immmigrants to the United States, specifically California, influence their projected household income. We will be building a multiple linear regression model to predict household income considering the following variables: `sex`, `relhead`, `age`, `statebrn`, `marstat`, `edyrs`, `occ`, `usdur1`, `usdurl`, `usdoc1`, `uscity`. 

- Description of the response variable

Our response variable is household income: the total income for a single household, reported in $USD. 

- Updated exploratory data analysis, incorporating any feedback from the proposal
- Explanation of the modeling process and why you chose those metohds, incorporating any feedback from the proposal
- Output of the final model
- Discussion of the assumptions for the final model
- Interpretations / interesting findings from the model coefficients
- Additional work of other models or analylsis not included in the final model.

*Use proper headings as needed.*