---
title: "Characteristics of Recent Mexican Immigrants to California, USA, that Influence Household Income"
author: "Ben 10"
date: "12/05/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE)
```

```{r load-packages, warning = FALSE, message = FALSE}
library(tidyverse)
library(broom)
library(leaps)
library(knitr)
library(dplyr)
library(rms)
```


```{r data}
data <- read_csv("/cloud/project/03-regression-analysis/data.csv")
```


## Section 1: Introduction 

### 1.1 Objective

We are aiming to build a model to determine which characteristics of Mexican immmigrants to the United States, specifically California, well-explain variation in household income. 

### 1.2 Description of Dataset

The dataset is from The Mexican Migration Project (MMP, *see References below for confidentiality terms), which was created in 1982 an interdisciplinary team of researchers to further our understanding of the complex process of Mexican migration to the United States. The project is a binational research effort co-directed by Jorge Durand, professor of Social Anthropology at the University of Guadalajara (Mexico), and Douglas S. Massey, professor of Sociology and Public Affairs, with a joint appointment in the Woodrow Wilson School, at Princeton University (U.S.).

Since its inception, the MMP's main focus has been to gather social and economic information on Mexican-US migration. The data collected has been compiled in a comprehensive database that is available to the public free of charge for research and educational purposes through its website. The MMP uses the ethnosurvey approach to gather data: in winter months, they randomly sample households in communities throughout Mexico, surveying household heads and members about their trips to the U.S., as well as economic and demographic information. They then conducted the same survey in areas in the U.S., sampling migrants from the same communities they surveyed in Mexico but who have not returned to Mexico. Thus, the sample of migrants includes residents in both Mexico and the U.S.

The MMP170 Database contains an initial file with general demographic, economic, and migratory information for each member of a surveyed household (PERS). Pers170 is a large data which has 132 variables and 176,701 observations. Therefore, we selected 17 relatively meaningful variables and filtered out rows that contain N/A's to create a new dataset labeled `data`.

### 1.3 Method

We will build a multiple linear regression model to predict household income considering the following variables: `sex`, `relhead`, `age`, `statebrn`, `marstat`, `edyrs`, `occtype`, `usdur1`, `usdurl`, `usdoc1`, `uscity`, `yrborn`. The data dictionary for these variables can be found in project->data->Data Dictionary.

Our response variable is household income. We chose to use the multiple linear regression because our response variable is numerical, and there are multiple predictor variables.

## 2. Exploratory Data Analysis

### 2.1 Data Cleaning

Our original data was extremely complex and necessitated us to clean our data extensively. All of our data cleaning can be found in the proposal. 

However, we did make some adjustments according to the feedback Dr. Tackett, which can be found below.

### 1.4 Updated Data Exploration

#### 1.4.1 Filter Only Immigrants in California

According to our previous data exploration, we found that the overwhelming majority of immigrants settled in California, as shown in the graph below:

```{r state-distribution-plot, results="hide"}
statedist <- within(data, 
                   usstatel <- factor(usstatel, 
                                      levels=names(sort(table(usstatel), 
                                                        decreasing=TRUE))))
ggplot(statedist, aes(x = usstatel)) + 
  geom_bar() +
  coord_flip()+
  labs(title = "Distribution of State of Residence", x= "State of Residence", y = "Count")
```

Hence, we decided to concentrate on California alone. Since the originial dataset is large, we have enough data left in California alone to produce meaningful analysis.

```{r caldata, results="hide"}
caldata <- data %>%
  filter(usstatel == "California")

caldata <- caldata%>%
  na.omit()
```

#### 1.4.2 Cut Household Income Groups

Originally, the distribution of Household Income- our response variable- was bimodal and had a median of 412,647 dollars. A plot of household income in natural units reveals very little information, due to a scattering of very high incomes which blow up the range of the plot. However, a logged plot reveals that household income almost looks like 3 separate distributions:

```{r nonfilt-income-plot, fig.width = 10, results="hide"}
incomeplot <- ggplot(data = caldata, aes(x = hhincome)) +
  geom_histogram()+
  labs(title = "Distribution of Household Income", x= "Household Income", y = "Count")
logincomeplot <- ggplot(data = caldata, aes(x = log(hhincome))) +
  geom_histogram(binwidth = .7)+
  labs(title = "Distribution of Log(Household Income)", x= "log(Household Income)", y = "Count")
cowplot::plot_grid(incomeplot, logincomeplot)
```

We determined that 412,647 dollars is an absurdly high median income for a survey of largely undocumented immigrants in the US and believe that a significant chunk of the high incomes were actually recorded in pesos. The documentation for the data from the Mexican Migration Project does not specify unit of hhincome; however, the project site details that researchers surveyed communities in Mexico, then traveled to the US to survey communities there. It seems likely that the communities surveyed in Mexico would report income in pesos and those surveyed in the US would report income in USD. However, the data was collected over a period of 10 years, during which the exchange rate between pesos and USD changed significantly. Hence, we cannot simply convert all the incomes that appear to be recorded in pesos into USD. 

Therefore, we decided to filter out the incomes above 60,000 to remove what appears to be a second distribution of incomes in pesos. We will also remove incomes of zero from our dataset, because it will interfere with our model accuracy. However, this compromises our model's predictive and explanatory range: our model will only be able to predict or explain the household income of those who already have jobs with income.

```{r filter-hhincome,results="hide"}
caldata <- caldata %>%
  mutate(hhincome = case_when(
    hhincome == .1 ~ 0,
    TRUE ~ hhincome
  )) #undoing mutation from proposal to return 0 income variables to 0
caldata <- caldata %>%
  filter(hhincome > 5, log(hhincome) < 8)
```


```{r hhincome-distribution, results="hide"}
ggplot(data = caldata, aes(x = hhincome)) +
  geom_histogram(binwidth = 100) +
  labs(title = "Distribution of Household Income", x= "Household Income (USD)", y = "Count")
```

Now the distribution of response variable (hhincome) looks like a right skewed normal distribution.

#### 1.4.3 Group cities by region

```{r cities, fig.align="center", results="hide"}
caldata <- caldata %>%
  filter(uscity %in% c("Bakersfield, CA", "Fresno, CA", "Los Angeles-Long Beach, CA", "Merced, CA","Orange County, CA","Riverside-San Bernardino, CA", "Sacramento, CA", "San Diego, CA", "San Francisco, CA", "San Jose, CA","Santa Barbara-Santa Maria-Lompoc, CA","Santa Cruz-Watsonville, CA","Vallejo-Fairfield-Napa, CA","Ventura, CA"))

caldata <- caldata %>%
  mutate(uscity=recode(uscity, "Bakersfield, CA"="centcal", "Fresno, CA"="centcal", "Los Angeles-Long Beach, CA"="socal", "Merced, CA"="centcal","Orange County, CA"="socal","Riverside-San Bernardino, CA"= "socal", "Sacramento, CA"="centcal", "San Diego, CA"= "socal", "San Francisco, CA"="bayarea", "San Jose, CA"="bayarea","Santa Barbara-Santa Maria-Lompoc, CA"= "socal","Santa Cruz-Watsonville, CA"="bayarea","Vallejo-Fairfield-Napa, CA"="bayarea","Ventura, CA"="socal"))


ggplot(data = caldata, aes(x = uscity))+ 
  geom_bar() +
  coord_flip()+
  labs(title = "Distribution of Cities in California", x = "City", y = "Count")
```

These immigrants to California arrived to the following cities: 

Bay Area: Vallejo-Fairfield-Napa, San Francisco, San Jose, Santa Cruz-Watsonville

Central California: Sacramento, Merced, Fresno, Bakersfield

Southern California: Santa Barbara-Santa Maria-Lompoc, Ventura, Los Angeles-Long Beach, Orange County, Riverside-San Bernardino, and San Diego.

We decided to simplify these cities into 3 regional categories: Bay Area, Southern California and Central California. 

Given the comparatively small number of cases in which no city was reported, we deleted these instances. The majority of immigrants went to LA-Long Beach area in Southern California.

#### 1.4.4 Remove Variable "relhead"

It turned out that all values from relhead (relationship to head of household) in our cleaned data were "1" or head. So we will remove this variable, as well as state variables since we are only using California data. We will also remove place data since we are using uscity, and occ since we are using occtype.

```{r remove-relhead, results="hide"}
caldata <- subset(caldata, select = -c(relhead, usstatel, usstate1,usplace1, usplacel,occ) )
```

#### 1.4.5 Mean-center "age" , "usdur1" and "usdurl"

We must center age and usdurl in order to have a useful model intercept interpretation.

```{r mean-age-usdurl, echo=FALSE, results="hide"}
mean(caldata$age) #mean age
mean(caldata$usdurl) #mean usdurl
mean(caldata$usdur1) #mean usdur1
mean(caldata$edyrs) #mean edyrs
```

The mean age in the dataset is 39.43 years ; the mean duration of last US migration is 60.27 months (about 5 years); and the mean duration of first US migration is 43.99 months (less than 3.5 years).

```{r age-usdurl-cent, results="hide"}
caldata <- caldata %>%
  mutate(age=age-mean(age))
caldata <- caldata %>%
  mutate(usdurl=usdurl-mean(usdurl))
caldata <- caldata %>%
  mutate(usdur1=usdur1-mean(usdur1))
```

### 1.4.6 Remove El Salvador Data and regionalize state born variable

```{r states, fig.align="center", results="hide"}
caldata <- caldata %>%
  filter(statebrn %in% c("Guanajuato","Jalisco","Mexico City","San Luis Potosí","Zacatecas","Coahuila","Morelos","Baja California del Norte","Querétaro","Michoacán","Guerrero","Durango","Chihuahua","Nayarit","Sonora","Aguascalientes","Veracruz","Campeche","Colima","Tabasco","México","Puebla","Nuevo Leon","Oaxaca","Tamaulipas"))

caldata <- caldata %>%
  mutate(statebrn=recode(statebrn,"Baja California del Norte"="Northern Mexico", "Tabasco"="South East Mexico", "Oaxaca"="South East Mexico", "Campeche"="South East Mexico","Coahuila"="Northern Mexico", "Chihuahua"="Northern Mexico","Durango"="Northern Mexico","Nuevo Leon"="Northern Mexico","Sonora"="Northern Mexico","Tamaulipas"="Northern Mexico","Aguascalientes"="Bajío","Guanajuato"="Bajío","Querétaro"="Bajío","San Luis Potosí"="Bajío","Zacatecas"="Bajío","Mexico City"="Central Mexico","México"="Central Mexico","Morelos"="Central Mexico","Puebla"="Central Mexico", "Colima"="Pacific Coast", "Guerrero"="Pacific Coast","Jalisco"="Pacific Coast","Michoacán"="Pacific Coast", "Nayarit"="Pacific Coast", "Veracruz"="South East Mexico"))

statebrndist <- within(caldata, 
                   statebrn <- factor(statebrn, 
                                      levels=names(sort(table(statebrn), increasing=TRUE))))

ggplot(statebrndist, aes(x = statebrn))+ 
  geom_bar() +
  coord_flip()+
  labs(title = "Distribution of Birth Region in Mexico", x = "Region", y = "Count")
```

We do not have any data from seven states: Baja California Sur, Chiapas, Hidalgo, Quintana Roo, Sinaloa, Tlaxcala, and Yucatán. We had a small amount of non-Mexican data, which we omitted.

We divided the remaining states into the following regions: 

South East Mexico: Tabasco, Oaxaca, Campeche, Veracruz

Northern Mexico: Coahuila, Chihuahua, Durango, Nuevo Leon, Sonora, Tamaulipas, Baja California del Norte

Bajío: Aguascalientes, Guanajuato, Querétaro, San Luis Potosí, Zacatecas 

Central Mexico: Mexico City, México, Morelos, Puebla 

Pacific Coast: Colima, Guerrero, Jalisco, Michoacán, Nayarit 

#### 1.4.7 Remove Obvious Collinear Variable

```{r yrborn-age, fig.align = "center", results="hide"}
ggplot(data = caldata, mapping = aes(x = yrborn, y = age)) +
  geom_point()+
  labs(title = "Correlation Between Age and Year Born", x = "Year Born", y = "Age")
```

`yrborn` and `age` provide the same information and are perfectly linear, therefore we decided to remove `yrborn` from consideration in the model.

#### 1.4.8 Simplify Occupation Type

```{r, results="hide"}
caldata <- caldata %>%
  filter(!(occtype %in% c("Retired", "Unemployed (seeking work)", "Other, unspecified (disabled, incarcerated, tourist and other)", "Homemaker", "Student"))) 
caldata %>%
  group_by(occtype) %>%
  count()
caldata <- caldata %>%
  mutate(occtype = case_when(
    occtype %in% c("Administrative support", "Administrator", "Arts", "Educator", 
                   "Professional", "Technical Worker") ~ "Professional",
    occtype %in% c("Manufacturing (skilled)", "Manufacturing (unskilled)") ~ "Manufacturing",
    occtype %in% c("Services", "Sales", "Technical Worker", "Transportation", 
                   "Protection") ~ "Service",
    occtype == "Agriculture" ~ "Agriculture"
  ))

occtypedist <- within(caldata, 
                   occtype <- factor(occtype, 
                                      levels=names(sort(table(occtype), increasing=TRUE))))

ggplot(occtypedist, aes(x = occtype))+ 
  geom_bar() +
  coord_flip()+
  labs(title = "Distribution of Type of Occupation", x = "Occupation Type", y = "Count")
```

We first filter out migrants with occupations indicating lack of paid employment, because our anaylsis focuses only on those migrants 

## Section 2: Regression Analysis 

## 2. Multiple Linear Regression Model

In an effort to explain which characteristics of migrants influence their household income, we will use a multiple linear regression model. Since our response variable is numerical with mulitple potential predictors, this is the best model at our disposal.

We will consider the potential interaction between principal occupation and number of years of school completed, since those are generally interconnected. We may also consider the interaction between documentation type and occupation type, although the effect may be insignificant. However, if the variables occtype, edyrs, or usdoc1 don't make it through the process of inital model selection, we will not include these interactions in the model as that would not be prudent. If other interactions appear significant, we will include these as well.

We will select our model using AIC criteria, because since we're dealing with people, we want to build a model that accounts for volatile human nature and the ever-changing socioeconomic and political climate that could influence someone's household income. AIC is used when we would rather say a variable is a relevant predictor, when in reality it might not be and so in this case, we would rather err on the side of a false positive because we are dealing with a constantly fluctuating issue.


### 2.1 Description of Methods

In our first multiple linear regression model, we included all 19 variables. Then, we used backwards model selection to reduce the model to 7 significant variables: edyrs, usdurl, sex, statebrn, usdoc1, occtype and age. We used AIC as the criterion because immigration is a complex social issue, hence we would prefer a model with many predictors and err on the side of false-positive, rather than having a leaner model.

After inital backwards selection, we will explore the possible interactions between remaining variables: edyrs, usdurl, sex, statebrn, usdoc1, occtype and age, to determine if any are significant.
The significant interactions that survived to our final model are: 

age*edyrs: p = 0 < 0.05      
(This interaction makes sense, because we expect older immigrants to be more educated)
statebrn*edyrs: p = 0.001 < 0.05
(This interaction makes sense, because we expect different region of Mexico have different level of development and hence access to education.)
statebrn*usdurl: p = 0.005 < 0.05
(This interaction makes sense, because immigrants from certain regions in Mexico may have a easier time staying longer in California because there is already a large community of immigrants from that region there.)
age*usdoc1: p = .007 < 0.05
(This interaction could make some sense, because the physical stamina required to immigrate illegally could be very related to age, and age is likely considered by the US government in applications for legal immigration status.)
usdurl*usdoc1: p = .012 < 0.05
(This interaction makes sense, because type of documentation and duration of migration would logically be highly related. Legal immigrants and contract workers can travel back and forth between Mexico and the US with greater ease than undocumented migrants, leading to potentially shorter stays, but they also don't face the same threat of deportation, which could possibly lead them to be able to stay in the US longer)

We included these interactions in our original full model, and did backward selection again to get our final model.

(Please see "Section 5 : Additional Work" for detailed coding process.)


### 2.2 Full Model after Evaluating Interactions

```{r full, results="hide"}
full_int_new_2 <- lm(hhincome ~ sex + age + statebrn + marstat + edyrs + occtype + usdur1 + usdurl + usdoc1 + uscity + sex*usdurl + age*usdurl + age*edyrs + statebrn*edyrs+statebrn*usdurl +occtype*statebrn + usdoc1*age + usdoc1*statebrn + usdoc1*usdurl, data=caldata)
kable(tidy(full_int_new_2),format="html" ,digits=3)
```

Model hidden due to length.

### 2.3 Final model
```{r final, results="hide"}
reduced_int_new_2 <- step(full_int_new_2, direction = "backward")

```
```{r}
sel_summary <- summary(reduced_int_new_2)
tidy(reduced_int_new_2, exponentiate = FALSE, conf.int = TRUE) %>%
kable(digits = 3, format = "markdown")
```



### 2.4 Description of Method in Model Diagnostics

We checked leverage, standardized residuals, estimate of standard deviation, Cook's distance, VIF and adjusted R-squared. 
(Please see "Section 5 : Additional Work" for detailed codes and graphs)

#### 2.4.1 Leverage

Just under half of our observations are high leverage points, meaning that their combinations of values for the predictor variables are very far from the typical combinations in the data. Because human circumstances and economic conditions are often so extremely variable, we would not expect most migrants to share common values for the predictor variables.

Of the individuals in the data with high leverage, two are highly educated professionals, and three have 5 years of education and work in manufacturing jobs. All are male. Age, documentation, and duration of migration vary. These points are potentially, but not certainly, influential points, so we use other methods to sort out influential points.

#### 2.4.2 Standardized Residuals

The 6% of our observations with standardized residuals of magnitude greater than 2 should be examined more closely- these are outliers, but they may not have an impact on the regression line. We can look plots of the standardized residuals versus all of our predictors. Plots of the standardized residuals for each predictor variable reveal that, for the most part, our data satisfies the constant variance assumption.

#### 2.4.3 Estimate of Standard Deviation

The estimate of our regression standard deviation using all observations is 481.0428, whereas the standard deviation estimate without points with large magnitude standardized residuals is 370.9477. Removing points with large magnitude standardized residuals would affect our conclusions by decreasing the standard error associated with our model coefficients, however, we do not want to damage our model’s integrity and explanatory power by removing too much human variability from the observations we base it on. We will examine Cook’s Distance to see if any observations have excessive overall impact or significantly affect the estimated coefficients when removed.

#### 2.4.4 Cook's Distance

No observations have a Cook’s Distance greater than 1, thus none of the high leverage points exert significantly greater influence on the final coefficients of our model than the other points and could distort our explanations.

#### 2.4.5 VIF

There are 10 coefficients with high VIFs (>10):

usdoc1Legal resident:	10.424955
usdurl:usdoc1Undocumented:	18.919794
statebrnCentral Mexico:	19.324207
statebrnCentral Mexico:edyrs:	19.878084
usdoc1Undocumented:	20.608986
statebrnSouth East Mexico:usdurl:	24.55331
age:usdoc1Undocumented:	25.065321
usdurl:	28.95936
statebrnSouth East Mexico:	33.951032
age:	34.366655

It is likely the state born coefficients are collinear with education, as education is highly related to region in Mexico -- Central Mexico and Northern Mexico have the best schools, while the South East has the worst. Length of time in the US obviously will be correlated to age, as well. Additionally, the coefficients of the regions may have high collinearity because when we divided the birth state into regions, there are very few and very geographically sparse observations in the South East Mexico, and a lot more observations in Central Mexico. Hence, in order to make each region more representative, we included some of the ambiguous states that could possibly be included in both regions into South East Mexico. Since the geographical regional divide is subjective and continuous, we expect there to be collinearity.

The duration of time in the US is likely collinear with documentation status, as the longer a person lives in the US, the harder it is to be undocumented. 


#### 2.4.6 Adjusted R-squared

The adjusted R-squared of our final model is 0.1810094, meaning that our model explains around 18.1% of the variation in household income. This is a small percentage. However, given that there are numerous social determinants of income, and we only included Californian data and those who have income between 1 and 60,000, the R-squared seems reasonable.


## Section 3: Discussion and Limitations 


### 3.1 Limitations

In order to complete an effective analysis in the time given, we greatly simplified our raw data to predict our response variable, household income. We ended up only analyzing a subgroup of the immigrants and focused on those who migrated to California because they made up a large majority of our original dataset. However, because of that, our findings may not be able to be generalized into other states in the US. If we were given more time, we would have analyzed the entirety of the dataset. 

Additionally, we cut a chunk of the data out because it appeared that some of the income was reported in pesos and USD, though we are not definitively sure. Further analysis could investigate why it appeared that some income was reported in a potentially different currency and adjust for it so we can include all observations in our analysis. We also cut off the data with no income to avoid the influence of zero inflation on the final model, hence biasing the model against immigrants who are unemployed. Future models should be adjusted for zero inflation.

Moreover, in an attempt to simplify the variable "statebrn", we grouped observations into regions. However, in order to arrive at a balanced grouping in terms of the number of observations in each region, we artificially divided the regions geographically, rather than dividing them according to socio-economic characteristics. As a result, the household income in some regions, such as South East Mexico, has a wide range. Furthermore, through compromising between geographic integrity and number of observations in each region, the majority of observations are still in Pacific Coast and Bajío regions due to the nature of the data. In fact, only those 2 regions had over 30 observations. Further work can look into weighing mechanisms for multiple linear models.

We also had very few data points for female immigrants. In the future we would want more equal numbers. 

According to our analysis of leverage and adjusted R-square, we conclude that there might be many outliers in our data, which makes sense since the immigrants in the data have drastically different demographics and income. Hence, our model should only be taken as a reference to analyse general trends, rather than to predict precise incomes. Given that wage depends on numerous socio-economic factors, our model is satisfactory, yet it cannot tell the entire story.

If we could continue to work on the project, we would operate under the assumption that the household income that is unusual was reported in pesos and potentially recorded in the Mexico and split the data set into two and investigate that. Our model could be stronger if we were able to include this very valuable data and inform our predictions with this information.  

### 3.2 Prediction

### 3.2.1 Effect of "Gender" on Wage 

```{r, results="hide"}
x0 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x0, interval = "confidence")
```
For a male who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), works in manufacturing (most common occupation in the dataset), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $905.59. We are 95% confident that the actual salary falls in the interval of [814.77, 996.24].

```{r}
x1 <- data.frame(sex = "F" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x1, interval = "confidence")
```
For a female who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), works in manufacturing (most common occupation in the dataset), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", her predicted salary is $577.84. We are 95% confident that the actual salary falls in the interval of [320.71, 834.96].


We can see from the prediction that there is a large gender wage gap, since a male's predicted wage is much higher than a female of the same average demographics.

### 3.2.2 Effect of "State born" on Wage

We used male as a model input because the majority of the immigrants in our data set are male. We used edyrs = 6 as the input because it is the average number of years of education for the data set. Manufacturing is the most common occupation type in the data, undocumented the most common immigration status. The rest of the inputs are 0 since those predictors are mean-centered.

```{r, results="hide"}
x0 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x0, interval = "confidence")
```
For a male who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), works in manufacturing (most common occupation in the dataset), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $905.50 We are 95% confident that the actual salary falls in the interval of [814.77, 996.24].

```{r, results="hide"}
x3 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Central Mexico", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x3, interval = "confidence")
```
For a male who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), works in manufacturing (most common occupation in the dataset), has undocumented status (most common documentation in the dataset), and was born in the region of of "Central Mexico", his predicted salary is $1560.12 We are 95% confident that the actual salary falls in the interval of [1054.74, 2065.50].


```{r, results="hide"}
x4 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Northern Mexico", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x4, interval = "confidence")
```
For a male who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), works in manufacturing (most common occupation in the dataset), has undocumented status (most common documentation in the dataset), and was born in the region of of "Northern Mexico", his predicted salary is $976.44 We are 95% confident that the actual salary falls in the interval of [502.38, 1450.50].

```{r}
x5 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="South East Mexico", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x5, interval = "confidence")
```

For a male who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), works in manufacturing (most common occupation in the dataset), has undocumented status (most common documentation in the dataset), and was born in the region of of "South East Mexico", his predicted salary is $786.43 We are 95% confident that the actual salary falls in the interval of [-317.25, 1890.11].

```{r, results="hide"}
x5 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Pacific Coast", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x5, interval = "confidence")
```

For a male who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), works in manufacturing (most common occupation in the dataset), has undocumented status (most common documentation in the dataset), and was born in the region of of "Pacific Coast", his predicted salary is $830.77 We are 95% confident that the actual salary falls in the interval of [743.67, 917.86].


The prediction suggest a hierarchy in wage discrimination based on the regions in Mexico that the immigrants are born in. Immigrants from the region of Central Mexico has the highest predicted wage, followed by Northern Mexico, Bajío, Pacific Coast, and South East Mexico has the lowest average predicted wage. This is supported by literature on economic inequality in Mexico. Specifically, early industrialization started in Central and Northern Mexico, allowing more mobility and opportunity for education and trade in these regions. In fact, in 2012, the northern border states (6 of the 32) accounted for 52.87% of the total export value. Therefore, it is possible that as a result, immigrants from these regions have an easier time earning relative higher wages than those from other regions.

However, it is worth noting that the confidence interval of South East Mexico is very large, including as low as 0 and as high as $1901.58. This could be due to the small sample size, as shown in the histogram below:

```{r, results="hide"}
SouthEast <- caldata %>%
  filter(statebrn == "South East Mexico")
ggplot(SouthEast, mapping = aes(x=hhincome)) +
  geom_histogram()+
  labs(x = "Household Income", y = "Count", title = "Distribution of Household Income in Immigrants Born in South East Mexico")
nrow(SouthEast)
```

There are only actually 19 observations in the data from this region.

It may also be because this region was artifiically created from 4 distinct cultural/economic/geographic regions in Mexico: the Yucatan Peninsula, Oaxaca, Veracruz and Chiapas & Tabasco. The regions were combined in order to be useful for analysis, but with more data we would have prefered to keep them as seperate regions, especially since Veracruz is relatively better-off than the rest of the states.

### 3.2.3 Effect of "Occupation Type" on Wage

We used male as a model input because the majority of the immigrants in our data set are male.  We used edyrs = 6 as the input because it is the average number of years of education for the data set. Undocumented is the most common immigration status and many of the immigrants in the data set were born in the region of Bajío. The rest of the inputs are 0 since those predictors are mean-centered.

<<<<<<< HEAD
```{r, results="hide"}
caldata %>%
  filter(occtype == "Manufacturing") %>%
  select(edyrs) %>%
  summary()
```

```{r, results="hide"}
x6 <- data.frame(sex = "M" , age = 0, edyrs = 6.281, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x6, interval = "confidence")
=======
```{r}
x6 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x6, interval = "confidence")
```

For a male who is 39 years old (average age), has 6 years of education (average edyrs), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $905.50 We are 95% confident that the actual salary falls in the interval of [814.7695, 996.2402].

```{r}
x7 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Agriculture", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x7, interval = "confidence")
>>>>>>> 3ed1d243e6748e1e172716272cb8b6e80961f99d
```

For a male who is 39 years old (average age), has 4.6 years of education (average edyrs for Agriculture workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $805.31. We are 95% confident that the actual salary falls in the interval of [695.6034, 915.0141].

<<<<<<< HEAD
```{r,results="hide"}
caldata %>%
  filter(occtype == "Agriculture") %>%
  select(edyrs) %>%
  summary()
```

```{r,results="hide"}
x7 <- data.frame(sex = "M" , age = 0, edyrs = 4.6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Agriculture", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x7, interval = "confidence")
=======
```{r}
x8 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x8, interval = "confidence")
```

For a male who is 39 years old (average age), has 7.25 years of education (average edyrs for Service industry workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $905.50. We are 95% confident that the actual salary falls in the interval of [814.7695, 996.2402].

```{r}
x9 <- data.frame(sex = "M" , age = 0, edyrs = 6, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Professional", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x9, interval = "confidence")
>>>>>>> 3ed1d243e6748e1e172716272cb8b6e80961f99d
```

For a male who is 39 years old (average age), has 9.972 years of education (average edyrs for Professional workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $1013.31 We are 95% confident that the actual salary falls in the interval of [826.5249, 1200.102].

```{r, results="hide"}
caldata %>%
  filter(occtype == "Agriculture") %>%
  select(edyrs) %>%
  summary()
caldata %>%
  filter(occtype == "Manufacturing") %>%
  select(edyrs) %>%
  summary()
caldata %>%
  filter(occtype == "Service") %>%
  select(edyrs) %>%
  summary()
<<<<<<< HEAD
```

```{r, results="hide"}
x8 <- data.frame(sex = "M" , age = 0, edyrs = 7.25, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x8, interval = "confidence")
```

For a male who is 39 years old (average age), has 7.25 years of education (average edyrs for Service industry workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $958.61 We are 95% confident that the actual salary falls in the interval of [862.97, 1054.25].

```{r, results="hide"}
=======
>>>>>>> 3ed1d243e6748e1e172716272cb8b6e80961f99d
caldata %>%
  filter(occtype == "Professional") %>%
  select(edyrs) %>%
  summary()
```

<<<<<<< HEAD
```{r, results="hide"}
x9 <- data.frame(sex = "M" , age = 0, edyrs = 9.972, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Professional", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x9, interval = "confidence")
```

For a male who is 39 years old (average age), has 9.972 years of education (average edyrs for Professional workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío", his predicted wage is $1182.06 We are 95% confident that the actual salary falls in the interval of [991.18, 1372.94].


=======
We used the same level of education for each prediction in order to focus on the effect of occupation type. However, different occupations tend to require different levels of education- for agriculture, manufacturing, service, and professional occupations the mean years spent in education are 4.6, 6.281, 7.25, and 9.972 respectively. Using the same education level for each of these predictions may not be representative of what is likely to occur in the real world; however, it allows us to examine the isolated effect of occupation type on household income.
>>>>>>> 3ed1d243e6748e1e172716272cb8b6e80961f99d

### 3.2.4 Effect of "Documentation Type" on Wage

```{r, results="hide"}
x10 <- data.frame(sex = "M" , age = 0, edyrs = 6.281, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Undocumented")
predict.lm(reduced_int_new_2, x10, interval = "confidence")
```

For a male who is 39 years old (average age), has 6.281 years of education (average edyrs for Manufacturing workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has undocumented status (most common documentation in the dataset), and was born in the region of "Bajío" (Baseline region), his predicted wage is $917.44 We are 95% confident that the actual salary falls in the interval of [826.32, 1008.57].

```{r, results="hide"}
x11 <- data.frame(sex = "M" , age = 0, edyrs = 6.281, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Temporary: Tourist/visitor")
predict.lm(reduced_int_new_2, x11, interval = "confidence")
```

For a male who is 39 years old (average age), has 6.281 years of education (average edyrs for Manufacturing workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has "Temporary: Tourist/visitor" status, and was born in the region of "Bajío" (Baseline region), his predicted wage is $892.81 We are 95% confident that the actual salary falls in the interval of [661.57, 1124.06].

```{r, results="hide"}
x12 <- data.frame(sex = "M" , age = 0, edyrs = 6.281, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Contract - Bracero")
predict.lm(reduced_int_new_2, x12, interval = "confidence")
```

For a male who is 39 years old (average age), has 6.281 years of education (average edyrs for Manufacturing workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has "Contract - Bracero" status, and was born in the region of "Bajío" (Baseline region), his predicted wage is $1323.98 We are 95% confident that the actual salary falls in the interval of [818.78, 1829.18].

```{r, results="hide"}
x13 <- data.frame(sex = "M" , age = 0, edyrs = 6.281, usdur1 = 0, usdurl = 0, statebrn="Bajío", occtype = "Manufacturing", usdoc1 = "Legal resident")
predict.lm(reduced_int_new_2, x13, interval = "confidence")
```

For a male who is 39 years old (average age), has 6.281 years of education (average edyrs for Manufacturing workers), first immigrated to the US for 5 years (average duration), last immigrated to the US for 3 years and 7 months (average duration), has "Legal resident" status, and was born in the region of "Bajío" (Baseline region), his predicted wage is $1079.49 We are 95% confident that the actual salary falls in the interval of [897.65, 1261.33].

The prediction suggest a hierarchy in wage discrimination based on the immigrants' documentation type. Immigrants who have "contract - barcero" documentation earn the highest predicted household income, followed by legal residents, undocumented, and lastly temporary workers. This is counter intuitive because one would imagine legal residents to earn more. However, this could be due to the relative imbalance in the observations in the two groups: the number of observations in "Legal resident" is significantly fewer than that in "Contract - Barcero".



## Section 4: Conclusion

Through our exploration and analysis, we found sex, age, years of education, occupation type, documentation type, duration of last US immigration and region born to be significant predictors of household income of Mexican immigrant living in California. Among these, there are significant interactions between:
- age and years of education,
- age and documentation type, 
- documentation type and duration of last US migration, 
- region born and years of education,
- and region born and duration of last US migration.

From our predictions, we observe a large gender wage gap: the average male has predicted wage of 893.32 USD, whereas the average female has predicted wage of 590.11 USD. It is shocking that the average wage for males in this sample is almost two times that of females in this sample. However, we also had significantly more male data points in this dataset, with 21 female datapoints and 477 male datapoints.

We also observed regional differences in terms of where the immigrant was born. Immigrants from the region of Central Mexico have the highest predicted wage, followed by Northern Mexico, Bajío, Pacific Coast, and South East Mexico has the lowest average predicted wage. However, since there is a prominent imbalance in number of observations from various regions, this conclusion should be taken with caution -- for example, we are notably missing data from two of the three states in the Yucatan Peninsula in the South East of Mexico, and over 50% of our data points are from the Pacific Coast.


In terms of occupation type, as expected the highest incomes are found among professionals, with service and manufacturing workers close behind. As anticipated, agricultural workers had the lowest income. In this case, our data is robust, as each category has over 30 datapoints. 

In terms of documentation type, we observed a hierarchy in wage discrimination based on the immigrants' documentation type. Immigrants who have "contract - barcero" documentation earn the highest predicted household income, followed by legal residents, undocumented, and lastly temporary workers.



## Section 5: Additional Work


### 5.1 Full Initial Model, No Interactions

```{r model}
full <- lm(hhincome ~ sex + age + statebrn + marstat + edyrs + occtype + usdur1 + usdurl + usdoc1 + uscity, data=caldata)
kable(tidy(full),format="html" ,digits=3)
```

### 5.2 Backward selection

```{r backward-selection}
reduced <- step(full, direction = "backward")
sel_summary <- summary(reduced)
tidy(reduced, exponentiate = FALSE, conf.int = TRUE) %>%
kable(digits = 3, format = "markdown")
```

Using backward selection based on AIC, we narrowed down to 7 variables: sex, edyrs, usdurl, statebrn, occtype, usdoc1 and age.

### 5.3 Interactions

To find potential interactions between the 7 variables, we used nested-F test for each of the possible interactions:

After inital backwards selection, we will explore the possible interactions between remaining variables: `edyrs`, `usdurl`, `sex`, `statebrn`, `occtype`, `usdoc1` and `age`, to determine if any are significant.

```{r int-model}
int_model_1 <- lm(hhincome ~ sex + age + statebrn + edyrs +occtype+ usdurl + usdoc1+ edyrs*usdurl, data = caldata)
anova(reduced, int_model_1, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.839
```
First, we tested the interaction between `edyrs` and `usdurl`. The p-value for this test was 0.839 > 0.05, therefore we will not include it in the model.

```{r int-model2}
int_model_2 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + sex*usdurl, data = caldata)
anova(reduced, int_model_2, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3) # p = 0.022
```
Then, we tested the interaction between `sex` and `usdurl`. The p-value for this test was 0.022 < 0.05, therefore we will include it in the model.

```{r int-model3}
int_model_3 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + age*usdurl, data = caldata)
anova(reduced, int_model_3, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.023
```
Then, we tested the interaction between `age` and `usdurl`. The p-value for this test was 0.023 < 0.05, therefore we will include it in the model.

```{r int-model4}
int_model_4 <- lm(hhincome ~ sex + age +statebrn+ edyrs+occtype+ usdoc1 + usdurl + sex*edyrs, data = caldata)
anova(reduced, int_model_4, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.506
```
Then, we tested the interaction between `sex` and `edyrs`. The p-value for this test was 0.506 > 0.05, therefore we will not include it in the model.

```{r int-model5}
int_model_5 <- lm(hhincome ~ sex + age + statebrn+ edyrs+occtype+ usdoc1 + usdurl + age*edyrs, data = caldata)
anova(reduced, int_model_5, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0
```
Then, we tested the interaction between `age` and `edyrs`. The p-value for this test was 0 < 0.05, therefore we will include it in the model.

```{r int-model 6}
int_model_6 <- lm(hhincome ~ sex + age + statebrn + edyrs+occtype+ usdoc1 + usdurl + age*sex, data = caldata)
anova(reduced, int_model_6, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.27
```
Then, we tested the interaction between `age` and `sex`. The p-value for this test was 0.27 > 0.05, therefore we will not include it in the model.

```{r int-model 7}
int_model_7 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + statebrn*sex, data = caldata)
anova(reduced, int_model_7, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.433
```
Then, we tested the interaction between `statebrn` and `sex`. The p-value for this test was  0.433> 0.05, therefore we will not include it in the model.


```{r int-model 8}
int_model_8 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + statebrn*age, data = caldata)
anova(reduced, int_model_8, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.098
```
Then, we tested the interaction between `statebrn` and `age`. The p-value for this test was  0.098> 0.05, therefore we will not include it in the model.

```{r int-model 9}
int_model_9 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + statebrn*edyrs, data = caldata)
anova(reduced, int_model_9, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.001
```
Then, we tested the interaction between `statebrn` and `edyrs`. The p-value for this test was  0.001< 0.05, therefore we will  include it in the model.

```{r int-model 10}
int_model_10 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + statebrn*usdurl, data = caldata)
anova(reduced, int_model_10, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.005
```
Then, we tested the interaction between `statebrn` and `usdurl`. The p-value for this test was 0.005 < 0.05, therefore we will include it in the model.

```{r int-model 11}
int_model_11 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + occtype*sex, data = caldata)
anova(reduced, int_model_11, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.707
```
Then, we tested the interaction between `occtype` and `sex`. The p-value for this test was 0.707 > 0.05, therefore we will not include it in the model.

```{r int-model 12}
int_model_12 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + occtype*age, data = caldata)
anova(reduced, int_model_12, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.155
```
Then, we tested the interaction between `occtype` and `age`. The p-value for this test was 0.155 > 0.05, therefore we will not include it in the model.

```{r int-model 13}
int_model_13 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + occtype*statebrn, data = caldata)
anova(reduced, int_model_13, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.016
```
Then, we tested the interaction between `occtype` and `statebrn`. The p-value for this test was 0.016 < 0.05, therefore we will include it in the model.

```{r int-model 14}
int_model_14 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + occtype*edyrs, data = caldata)
anova(reduced, int_model_14, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.529
```
Then, we tested the interaction between `occtype` and `edyrs`. The p-value for this test was 0.529 > 0.05, therefore we will not include it in the model.

```{r int-model 15}
int_model_15 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + occtype*usdurl, data = caldata)
anova(reduced, int_model_15, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.134
```
Then, we tested the interaction between `occtype` and `usdurl`. The p-value for this test was 0.134 > 0.05, therefore we will not include it in the model.

```{r int-model 16}
int_model_16 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + usdoc1*sex, data = caldata)
anova(reduced, int_model_16, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.533
```
Then, we tested the interaction between `usdoc1` and `sex`. The p-value for this test was 0.533 > 0.05, therefore we will not include it in the model.

```{r int-model 17}
int_model_17 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + usdoc1*age, data = caldata)
anova(reduced, int_model_17, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.007
```
Then, we tested the interaction between `usdoc1` and `age`. The p-value for this test was 0.007 < 0.05, therefore we will include it in the model.

```{r int-model 18}
int_model_18 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + usdoc1*statebrn, data = caldata)
anova(reduced, int_model_18, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.024
```
Then, we tested the interaction between `usdoc1` and `statebrn`. The p-value for this test was 0.024 < 0.05, therefore we will include it in the model.

```{r int-model 19}
int_model_19 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + usdoc1*edyrs, data = caldata)
anova(reduced, int_model_19, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.09
```
Then, we tested the interaction between `usdoc1` and `edyrs`. The p-value for this test was 0.09 > 0.05, therefore we will not include it in the model.

```{r int-model 20}
int_model_20 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + usdoc1*occtype, data = caldata)
anova(reduced, int_model_16, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.533
```
Then, we tested the interaction between `usdoc1` and `occtype`. The p-value for this test was 0.53 > 0.05, therefore we will not include it in the model.

```{r int-model 21}
int_model_21 <- lm(hhincome ~ sex + age + statebrn+edyrs+occtype+ usdoc1 + usdurl + usdoc1*usdurl, data = caldata)
anova(reduced, int_model_21, test = "Chisq") %>% 
  kable(format = "markdown", digits = 3)  # p = 0.012
```
Then, we tested the interaction between `usdoc1` and `usdurl`. The p-value for this test was 0.012 < 0.05, therefore we will include it in the model.

Through nested F-test, we observed significant interactions between sex & usdurl, age & usdurl, age * edyrs, statebrn & edyrs, statebrn & usdurl, occtype & statebrn, usdoc1 & age, usdoc1 & statebrn, and usdoc1 & usdurl, and we will be including them in our model selection.

### 5.4 Model with Interactions

```{r final-model}
reduced_int <- lm(hhincome ~ sex + age + edyrs + usdurl + usdoc1 + occtype + sex*usdurl + age*usdurl + age*edyrs + statebrn*edyrs+statebrn*usdurl +occtype*statebrn + usdoc1*age + usdoc1*statebrn + usdoc1*usdurl, data=caldata)
kable(tidy(reduced_int),format="html" ,digits=3)
```

### 5.5 Backwards Selection from Initial Model with Interactions

Since we observed 9 pairs of significant interactions, we will do the backward selection again with the new interaction terms.

```{r}
full_int <- lm(hhincome ~ sex + age + statebrn + marstat + edyrs + occtype + usdur1 + usdurl + usdoc1 + uscity + sex*usdurl + age*usdurl + age*edyrs + statebrn*edyrs+statebrn*usdurl +occtype*statebrn + usdoc1*age + usdoc1*statebrn + usdoc1*usdurl, data=caldata)
kable(tidy(full_int),format="html" ,digits=3)
```

```{r}
reduced_int_new <- step(full_int, direction = "backward")
sel_summary <- summary(reduced_int_new)
tidy(reduced_int_new, exponentiate = FALSE, conf.int = TRUE) %>%
kable(digits = 3, format = "markdown")
```

After backwards selection, including all possible relevant interactions, our model contains the following variables: sex, age, edyrs, usdurl, usdoc1, occtype, statebrn. It also includes these interactions: age & edyrs, edyrs & statebrn, usdurl & statebrn, age & usdoc1, and usdurl & usdoc1.

### 5.6 Model Diagnostics

```{r augment}
mig_output <- augment(reduced_int_new) %>%
  mutate(obs_num = row_number())
```

```{r high-leverage}
leverage_threshold <- 2*(5+1)/nrow(caldata)

ggplot(data = mig_output, aes(x = obs_num,y = .hat)) + 
  geom_point(alpha = 0.7) + 
  geom_hline(yintercept = leverage_threshold,color = "red") +
  labs(x = "Observation Number",y = "Leverage",title = "Leverage")

highlev <- mig_output %>% 
  filter(.hat > leverage_threshold)

nrow(highlev)/nrow(caldata)
```

Just under half of our observations are high leverage points, meaning that their combinations of values for the predictor variables are very far from the typical combinations in the data. Because human circumstances and economic conditions are often so extremely variable, we would not expect most migrants to share common values for the predictor variables. 

We can look at the four observations with the highest leverage:

```{r top-leverage-points}
highlev %>%
  filter(.hat > .5)
```

Within the individuals in the data with high leverage, two are highly educated professionals, and three have 5 years of education and work in manufacturing jobs. All are male. Age, documentation, and duration of migration vary. These points are potentially, but not certainly, influential points, so we use other methods to sort out influential points.

```{r standardized-residuals}
ggplot(data = mig_output, aes(x = .fitted,y = .std.resid)) +
  geom_point(alpha = 0.7) + 
  geom_hline(yintercept = 0,color = "red") +
  geom_hline(yintercept = -2,color = "red",linetype = "dotted") +
  geom_hline(yintercept = 2,color = "red",linetype = "dotted") +
  labs(x ="Predicted Value",y ="Standardized Residuals",title = "Standardized Residuals vs. Predicted Values")

high_stdresid <- mig_output %>% 
  filter(abs(.std.resid) > 2)

nrow(high_stdresid)/nrow(mig_output)
```
  
The 6% of our observations with standardized residuals of magnitude greater than 2 should be examined more closely- these are outliers, but they may not have an impact on the regression line. We can look plots of the standardized residuals versus all of our predictors.

```{r std-resid-predictor-plots, fig.width = 16, fig.height = 14}
ageresidplot <- ggplot(data = mig_output, aes(x = age, y = .std.resid)) +
  geom_point(alpha = 0.7) + 
  geom_hline(yintercept = 0,color = "red") +
  labs(x ="Centered Age (yrs)", y ="Standardized Residuals",
       title = "Standardized Residuals vs. Age")
edyrsresidplot <- ggplot(data = mig_output, aes(x = edyrs, y = .std.resid)) +
  geom_point(alpha = 0.7) + 
  geom_hline(yintercept = 0,color = "red") +
  labs(x ="Centered Years of Education (yrs)", y ="Standardized Residuals",
       title = "Standardized Residuals vs. Education Years")
usdurlresidplot <- ggplot(data = mig_output, aes(x = usdurl, y = .std.resid)) +
  geom_point(alpha = 0.7) + 
  geom_hline(yintercept = 0,color = "red") +
  labs(x ="Centered Duration of Last Migration to US (months)", y ="Standardized Residuals",
       title = "Standardized Residuals vs. Duration of Last US Migration")
sexresidplot <- ggplot(data = mig_output, aes(x = sex, y = .std.resid)) +
  geom_boxplot() + 
  geom_hline(yintercept = 0,color = "red") +
  labs(x ="Sex", y ="Standardized Residuals",title = "Standardized Residuals vs. Sex")
statebrnresidplot <- ggplot(data = mig_output, aes(x = statebrn, y = .std.resid)) +
  geom_boxplot() + 
  geom_hline(yintercept = 0,color = "red") +
  labs(x ="State of Birth", y ="Standardized Residuals",title = "Standardized Residuals vs. State of Birth")
occtyperesidplot <- ggplot(data = mig_output, aes(x = occtype, y = .std.resid)) +
  geom_boxplot() + 
  geom_hline(yintercept = 0,color = "red") +
  labs(x ="Occupation Type", y ="Standardized Residuals",title = "Standardized Residuals vs. Occupation Type")
usdoc1residplot <- ggplot(data = mig_output, aes(x = usdoc1, y = .std.resid)) +
  geom_boxplot() + 
  geom_hline(yintercept = 0,color = "red") +
  labs(x ="Documentation Type on First US Migration", y ="Standardized Residuals",title = "Standardized Residuals vs. Documentation Type")
cowplot::plot_grid(ageresidplot, edyrsresidplot, usdurlresidplot, sexresidplot, statebrnresidplot, occtyperesidplot, usdoc1residplot)
```

Plots of the standardized residuals for each predictor variable reveal that, for the most part, our data satisfies the constant variance assumption. 

```{r regression-standard-deviation}
glance(reduced_int_new)$sigma

mig_output %>%
  filter(abs(.std.resid) <= 2) %>%
  summarise(sigma_est = sqrt(sum(.resid^2)/(n() - 5 - 1)))
```

The estimate of our regression standard deviation using all observations is 481.0428, whereas the standard deviation estimate without points with large magnitude standardized residuals is 370.9477. Removing points with large magnitude standardized residuals would affect our conclusions by decreasing the standard error associated with our model coefficients, however, we do not want to damage our model's integrity and explanatory power by removing too much human variability from the observations we base it on. We will examine Cook's Distance to see if any observations have excessive overall impact or significantly affect the estimated coefficients when removed.

```{r cooks-distance}
ggplot(data = mig_output, aes(x = obs_num, y = .cooksd)) + 
  geom_point(alpha = 0.7) + 
  geom_hline(yintercept=1,color = "red")+
  labs(x= "Observation Number",y = "Cook's Distance",title = "Cook's Distance") +
  geom_text(aes(label = ifelse(.cooksd>1,as.character(obs_num),"")), nudge_y = .05)
```

No observations have a Cook's Distance greater than 1, thus none of the high leverage points exert significantly greater influence on the final coefficients of our model than the other points and could distort our explanations.


```{r vif}
tidy(vif(reduced_int_new))
```

There appear to be several coefficients which exhibit dangerously high multicollinearity. This is discussed in Section 2.

```{r adj-r-sq}
summary(reduced_int_new)$adj.r.squared
```

The adjusted R-squared for our final model is 0.181. This means the approximately 18% of the variation in household income is well-accounted for by our model.

### 5.7 Gender Wage Gaps

```{r}
gender <- data.frame("Gender" = c("Male", "Female"), "pred_hhincome" = c(893.32, 590.11))
gender
ggplot(gender, mapping = aes(x= Gender, y =pred_hhincome ))+
  geom_col()+
  labs(y = "Predicted Household Income of Average Immigrant", title = "Gender Wage Gap")


region <- data.frame("Region" = c( "Manufacturing", "Agriculture","Bajío", "Pacific Coast", "South East Mexico" ), "pred_hhincome" = c( 917.4427, 958.6091,893.32,814.86,788.32 ))
region <- within(region, 
                   pred_hhincome <- factor(pred_hhincome, 
                                      levels=names(sort(table(pred_hhincome), increasing=TRUE))))
ggplot(region, mapping = aes(x= Region, y =pred_hhincome ))+
  geom_col()+
  labs(y = "Predicted Household Income of Average Male Immigrant", title = "Region Wage Gap")


occupation <- data.frame("Occupation" = c( "Manufacturing", "Agriculture","Service", "Professional" ), "pred_hhincome" = c( 917.4427, 958.6091,1182.058 ,1182.06 ))
ggplot(occupation, mapping = aes(x= Occupation, y =pred_hhincome ))+
  geom_col()+
  labs(y = "Predicted Household Income of Average Male Immigrant", title = "Occupation Wage Gap")


documentation <- data.frame("Documentation" = c( "Undocumented", "“Temporary: Tourist/visitor”","Contract - Bracero", "Legal resident" ), "pred_hhincome" = c( 917.4427, 892.8114,1323.98 ,897.65 ))
ggplot(documentation, mapping = aes(x= Documentation, y =pred_hhincome ))+
  geom_col()+
  labs(y = "Predicted Household Income of Average Male Immigrant", title = "Documentation Wage Gap")
```

